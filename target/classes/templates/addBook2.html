<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="header :: headerFragment">
<title id="pageTitle">Save book data</title>
</head>
<body>
	<div th:replace="header :: header"></div>
	<main>
	<h1>Save book data</h1>
	<form action="#" th:action="@{/books/addBook}" th:object="${book}"
		method="post" id="addBookForm">
		<p>
			<label for="title">Title:</label><input type="text"
				th:field="*{title}" />
		</p>
		<p>
			<label for="isbn">ISBN:</label><input type="text" th:field="*{isbn}" />
		</p>
		<p>
			<label for="genre">Genre:</label><select th:field="*{genre}">
				<option th:each="genre : ${genres}" th:value="${genre.name}"
					th:text="${genre.name}"></option>
			</select><!--span
				onClick="removeFieldById('genre');this.onclick='removeOnClick(event)'"
				class="spanButton" id="makeNoGenre" style="cursor: pointer">No
				genre</span -->
				<label for="noGenre">No genre</label><input type="checkbox" name="noGenre" id="noGenre" />
		</p>
		<p>
			<label for="location">Location:</label><select th:field="*{location}">
				<option th:each="location : ${locations}"
					th:value="${location.name}" th:text="${location.name}"
					th:title="${location.description}"></option>
			</select>
		</p>
		<p>
			<label></label><input type="submit" value="Add" />
		</p>
	</form>
	<br />
	<span th:text="${message}" id="message">Message</span> </main>
	<script>

function removeOnClick(event) {
	removeFieldById('genre');
	var t = event.target;
	t.removeEventListener("click", removeOnClick);
}

function offerGenres(previousSiblingId){
	//make span-button
	var spb = document.createElement("span");
	spb.innerHTML = "Have genre";
	spb.className = "spanButton";
	spb.id = "makeGenre";
	spb.style = "cursor: pointer";
	var ps = document.getElementById(previousSiblingId);

	//put it on page
	insertAfter(spb, ps);
	
	spb.addEventListener("click", function(){

		//get genres by ajax
		//call /rest/genres/allXML
		
		
		var sel = document.createElement("select");
		sel.id = "genre";
		sel.name = "genre";

		insertAfter(sel, this);

		$.getJSON("/rest/genres/allJson", function(data){

			$('#genre').text('');
			for(var index in data){
				$('#results').append('<option>'+data[index].title+'</option>')
				}
			
		});
	});
}

window.onload=function(){
	applyNoGenres("addBookForm");
}

function applyNoGenres(formId){

	if(!document.getElementById(formId)){
		alert("applyNoGenres could not find form of id " + formId);
		return false;
		}

	var form = document.getElementById(formId);

	if(form.querySelector("#noGenre")){
		//switch for have genre found
		var checkb = form.querySelector("#noGenre");
		checkb.addEventListener("click", function(){toggleGenre(this.checked)});
		form.addEventListener("submit", function(){removeFieldById('genre')}, true);				
		}
	else{
		alert("function applyNoGenres could not find the noGenre switch");
		return false;
		}
}

function toggleGenre(isChecked){
	if(!document.getElementById("genre")){
		console.log("toggleGenre could not find element by id 'genre'");
		return false;
		}
	if(isChecked){
		document.getElementById("genre").disabled = true;
		}
	else{
		console.log("No");
		document.getElementById("genre").disabled = false;
		}
}

</script>
</body>
</html>